name: CI for LSTM Model

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          # Usar 3.10 o superior si es necesario, 3.8 está bien, pero TensorFlow prefiere versiones recientes.
          python-version: '3.10' 

      - name: Install rclone
        run: |
          # Actualizar e instalar rclone para la descarga del dataset
          sudo apt-get update && sudo apt-get install -y rclone

      - name: Configure rclone and download Dataset
        env:
          # Variable de entorno para la configuración de rclone
          RCLONE_CONFIG: ${{ secrets.RCLONE_CONFIG }}
        run: |
          # Crear carpeta y escribir la configuración de rclone
          mkdir -p ~/.config/rclone/
          printf "%s\n" "$RCLONE_CONFIG" > ~/.config/rclone/rclone.conf
          # Descargar el archivo CSV
          rclone copy MiDrive:microprosesadores/datos_modificados1.csv . --config ~/.config/rclone/rclone.conf
          echo "Dataset datos_modificados1.csv descargado."

      - name: Install dependencies (LSTM/TensorFlow)
        run: |
          python -m pip install --upgrade pip
          # TensorFlow y Keras son necesarios para el modelo LSTM
          pip install -r requirements.txt 
          pip install notebook pandas numpy scikit-learn matplotlib tensorflow keras

      - name: Run training Notebook (LSTM)
        # Ejecuta el notebook de LSTM. Asegúrate de que este notebook exista y genere los artefactos esperados.
        run: jupyter nbconvert --to notebook --execute --inplace lstm.ipynb 

      - name: Upload LSTM Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: lstm-prediction-results
          path: |
            # Asegúrate de que tu lstm.ipynb guarde los archivos con estos nombres
            plot_lstm.png # Gráfico generado
            lstm_model.h5 # Modelo LSTM guardado
            metrics_lstm.txt # Métricas calculadas
